
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>euccas.github.io</title>
  <meta name="author" content="euccas">

  
  <meta name="description" content="使用Octopress搭建这个blog已经有一段时间了，记录几个使用中需要注意的Tips. Tip 1: Clone Repo 如果需要重新复制一份已经存在的blog repo，在重新复制的blog repo上继续发布更新blog，那么需要注意： 首先需要复制的repo是source branch &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://euccas.github.io/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="euccas.github.io" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
<!--- MathJax Configuration -->
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">euccas.github.io</a></h1>
  
    <h2>why a developer writes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscribe" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 13.310204,73.332654 C 5.967347,73.332654 0,79.322448 0,86.621428 c 0,7.338776 5.967347,13.262246 13.310204,13.262246 7.370408,0 13.328572,-5.92245 13.328572,-13.262246 0,-7.29898 -5.958164,-13.288774 -13.328572,-13.288774 z M 0.01530612,33.978572 V 53.143878 C 12.493878,53.143878 24.229592,58.02347 33.068368,66.865306 41.894898,75.685714 46.767346,87.47449 46.767346,100 h 19.25 C 66.017346,63.592858 36.4,33.979592 0.01530612,33.978572 l 0,0 z M 0.03877552,0 V 19.17449 C 44.54796,19.17551 80.77551,55.437756 80.77551,100 H 100 C 100,44.87653 55.15102,0 0.03877552,0 z"></path></svg></a></li>
  
</ul>
  
  
  
  
  
  
  
  
  
  
    
      <form action="https://www.google.com/search" method="get">
        <fieldset role="search">
          <input type="hidden" name="sitesearch" value="euccas.github.io" />
    
          <input class="search" type="text" name="q" results="0" placeholder="Search"/>
        </fieldset>
      </form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20161011/octopress-tips.html">Octopress Tips</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-10-11T22:36:44-07:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:36 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>使用Octopress搭建这个blog已经有一段时间了，记录几个使用中需要注意的Tips.</p>

<h1 id="tip-1-clone-repo">Tip 1: Clone Repo</h1>

<p>如果需要重新复制一份已经存在的blog repo，在重新复制的blog repo上继续发布更新blog，那么需要注意：</p>

<p>首先需要复制的repo是source branch.</p>

<p>如果repo的默认branch已经设定为source branch:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">git clone &lt;repo url&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>如果repo的默认branch设定为master branch:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">git clone &lt;repo url&gt;
</span><span class="line">git pull origin source</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>然后需要把master branch复制到<code>_deploy</code>目录。注意<code>_deploy</code>目录是在Octopress生成post的过程中必须存在的。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">git clone &lt;repo url&gt; _deploy
</span><span class="line">cd _deploy
</span><span class="line">git pull origin master</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="tip-2-push-changes-to-source">Tip 2: Push Changes to Source</h1>

<p>使用<code>rake gen_deploy</code>将改动发布到<code>master branch</code>之后，还需要把source的改动也提交到<code>source branch</code>。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">git push origin source</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="tip-3-execute-rake-commands">Tip 3: Execute Rake Commands</h1>

<p>如果因为<code>rake</code>版本问题造成<code>rake</code> command不能够在repo中执行，就需要使用<code>bundle exec rake</code>执行。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">bundle exec rake new_post
</span><span class="line">bundle exec rake generate
</span><span class="line">bundle exec rake preview
</span><span class="line">bundle exec rake deploy</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="tip-4-errors-in-gendeploy">Tip 4: Errors in gen_deploy</h1>

<p><code>rake gen_deploy</code>的过程中，如果在<code>generate</code>步骤中出现错误（比如部分post的文本不符合markdown语法），一些情况下可能会造成generate目录中的文件被删除。而<code>gen_deploy</code>过程此时并不会结束，<code>deploy</code>会继续进行，这样最终的commit就会把原来已经发布的blog内容删除。防止出现这种问题的安全做法是分步执行<code>rake generate</code>和<code>rake deploy</code>。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20161011/install-additional-packages-in-winpython.html">Install Additional Packages in WinPython</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-10-11T17:11:51-07:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>5:11 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>For people who need use portable Python on Windows, <a href="https://winpython.github.io/">WinPython</a> is a good choice. WinPython is a free open-source portable distribution of Python. The project is hosted on <a href="https://github.com/winpython">github</a>. It is also a good alternative to <a href="http://portablepython.com/">Portable Python</a>, which is not being developed anymore.</p>

<p>In this post I’ll show you how could you install additional packages to WinPython.</p>

<h1 id="install-winpython">Install WinPython</h1>

<p>WinPython is portable. It means that you can download WinPython from the <a href="http://winpython.sourceforge.net/">WinPython download page</a>, add it to your system PATH, and start using it without any installation.</p>

<ul>
  <li>Unzip the downloaded WinPython Package to a local directory, eg. <code>C:\WinPython</code>.</li>
  <li>Add the local directory path to your system’s <code>PATH</code> variable. You can use Windows command <code>set</code> or <code>setx</code>.</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">   set PATH=C:\WinPython\;%PATH%</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Now you can open a Windows cmd prompt, and test your installed python version.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">where python
</span><span class="line">&gt;&gt;&gt; C:\WinPython\python.exe</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="install-a-package">Install a package</h1>

<p>You can install a Python Package to WinPython using <code>pip</code>. If you have other versions of Python installed on your computer, you’ll need make sure the <code>pip</code> you use actually is the one WinPython provides.</p>

<p>Where is the <code>pip</code>?</p>

<p>It’s in the <code>Scripts</code> directory of the WinPython path.
For example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">C:\WinPython\Scripts</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Now you can use the WinPython <code>pip</code> to install additional Python packages.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&lt;WinPython Path&gt;\Scripts\pip install &lt;package name&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>If the installation successfully done, you will find the installed packages in WinPython’s library path.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&lt;WinPython Path&gt;\Lib\site-packages\&lt;package name&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>That’s it! Your Python package is ready to use!</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20161010/jenkins-user-habits-4.html">高效Jenkins用户的第4个习惯</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-10-10T21:32:01-07:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:32 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>本文内容部分来源于<strong>Andrew Bayer</strong>发布在SlideShare上的 <a href="http://www.slideshare.net/andrewbayer/seven-habits-of-highly-effective-jenkins-users-2014-edition"><em>7 habits of highly productive Jenkins Users (2014 Edition)</em></a>.</p>

<h1 id="jenkinsplugin">习惯 4: 精选你所使用的Jenkins功能插件(Plugin)</h1>

<p>当你使用了越来越多的Jenkins功能插件时，就需要花一些时间和精力来维护和清理所有的功能插件。 因为当你安装了太多的Jenkins插件时，有可能会带来一些不好的效果，诸如减慢系统速度，占用多过资源，产生无效的记录文件等等。为了避免使用过多的Jenkins插件造成的各种问题，你应该注意下面几个方面。</p>

<h2 id="section">1. 只安装你真正需要的功能插件</h2>

<p>在安装一个功能插件之前，你都应该问一个问题：我真的需要这个插件吗？</p>

<p>如果你并不打算真正使用一个插件，就不要安装在Jenkins Master上。</p>

<p>不同的插件可能包含有一些类似的功能，你所需要完成的事情，也不仅仅只有一个插件可以实现。这时就需要在一些功能类似的插件中选择你真正所需的。</p>

<p>功能插件可能会给Jenkins service的稳定性造成预期之外的影响，并且可能增加系统的负载和每一个job运行的时间。充分考虑到这些可能的负作用，尽量避免安装你并不是真正需要的插件。</p>

<h2 id="section-1">2. 清理旧的插件和数据</h2>

<p>定期检查和删除你不再使用的Jenkins功能插件。</p>

<p>在Jenkins管理页面 (Manage Jenkins) 中，注意关于old data的描述。当你删除一个Jenkins插件后，要把有关的历史数据也同时删除。</p>

<p>及时删除不需要的数据，可以加速Jenkins Master启动时加载配置和所有jobs的过程。</p>

<h2 id="section-2">3. 建立你的必备插件列表</h2>

<p>根据你的使用需求和经验，选择你所需要的Jenkins功能插件。这些功能插件应该是满足你所需要的功能，并且性能良好稳定。为你的这些插件建立一个列表并且维护它。</p>

<p><strong>Andrew Bayer</strong>推荐了一些他所使用的Jenkins功能插件。所有这些提供的插件都可以通过Jenkins插件管理功能(Manage Plugins)来查找和安装。</p>

<ul>
  <li>
    <p><strong>Job Config History</strong></p>

    <ul>
      <li><a href="https://wiki.jenkins-ci.org/display/JENKINS/JobConfigHistory+Plugin">插件介绍</a></li>
      <li>功能：保存job configuration的历史，记录每一次改动的信息。对于job configuration每一次的改变，保存一个config.xml文件。提供overview页面，方便查看全部的改变。可以对比查看两次改动之间的区别。</li>
    </ul>
  </li>
  <li>
    <p><strong>Static Analysis Plugins</strong></p>

    <ul>
      <li><a href="https://wiki.jenkins-ci.org/display/JENKINS/Static+Code+Analysis+Plug-ins">插件介绍</a></li>
      <li>功能：处理各种静态代码分析结果数据，生成可视化报告（包括趋势图，Build Summary，结果汇总分析等等）</li>
    </ul>
  </li>
  <li>
    <p><strong>xUnit</strong></p>

    <ul>
      <li><a href="https://wiki.jenkins-ci.org/display/JENKINS/xUnit+Plugin">插件介绍</a></li>
      <li>功能：生成和发布单元测试报告。可以把各种测试结果转化为jnit格式。</li>
    </ul>
  </li>
  <li>
    <p><strong>Parameterized Trigger</strong></p>

    <ul>
      <li><a href="https://wiki.jenkins-ci.org/display/JENKINS/Parameterized+Trigger+Plugin">插件介绍</a></li>
      <li>功能：参数化配置trigger build. 对于一个build job，可以定义多个配置，用于不同的条件和参数。</li>
    </ul>
  </li>
  <li>
    <p><strong>Conditional Build Step</strong></p>

    <ul>
      <li><a href="https://wiki.jenkins-ci.org/display/JENKINS/Conditional+BuildStep+Plugin">插件介绍</a></li>
      <li>功能：可以灵活配置的build step。通常和Parameterized Trigger配合使用。</li>
    </ul>
  </li>
  <li>
    <p><strong>Tool Environment</strong></p>

    <ul>
      <li><a href="https://wiki.jenkins-ci.org/display/JENKINS/Tool+Environment+Plugin">插件介绍</a></li>
      <li>功能：让你可以自定义使用Jenkin tool的自动安装。在一个job的执行过程中安装指定的tools，供这个job使用。</li>
    </ul>
  </li>
  <li>
    <p><strong>EnvInject</strong></p>

    <ul>
      <li><a href="https://wiki.jenkins-ci.org/display/JENKINS/EnvInject+Plugin">插件介绍</a></li>
      <li>功能：帮助你管理环境变量，包括删除Jenkins Java process引入的一些环境变量，在一个node启动时设置所需的环境变量，设置密码值等等。</li>
    </ul>
  </li>
  <li>
    <p><strong>Rebuild</strong></p>

    <ul>
      <li><a href="https://wiki.jenkins-ci.org/display/JENKINS/Rebuild+Plugin">插件介绍</a></li>
      <li>功能：可以rerun每一个被执行过的parameterized build，保存了parameterized build每一次使用的参数，并且允许你在执行rebuild时修改这些参数。</li>
    </ul>
  </li>
  <li>
    <p><strong>Build Timeout</strong></p>

    <ul>
      <li><a href="https://wiki.jenkins-ci.org/display/JENKINS/Build-timeout+Plugin">插件介绍</a></li>
      <li>功能：设置build的时间限制，当一个build时间超过预设时，会自动被停止。这个插件不能用于Jenkins pipelines.</li>
    </ul>
  </li>
</ul>

<p><strong>阅读同主题内容</strong></p>

<ul>
  <li><a href="http://euccas.github.io/blog/20151210/jenkins-user-habits-1.html">高效Jenkins用户的第1个习惯</a></li>
  <li><a href="http://euccas.github.io/blog/20151215/jenkins-user-habits-2.html">高效Jenkins用户的第2个习惯</a></li>
  <li><a href="http://euccas.github.io/blog/20160523/jenkins-user-habits-3.html">高效Jenkins用户的第3个习惯</a></li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20160928/the-uber-challenge-of-cross-application-testinng.html">GTAC: The Uber Challenge of Cross-Application Testing</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-28T23:17:30-07:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>11:17 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Inspired by Matt Cutts’ TED talk: <a href="https://www.ted.com/talks/matt_cutts_try_something_new_for_30_days?language=en">Try something new for 30 days</a>, I’m starting a “30 Days of GTAC” project. Google’s Test Automation Conference <a href="https://developers.google.com/google-test-automation-conference/">GTAC</a> is an annual test automation conference which brings together engineers from industry and academia to discuss advances in test automation and related engineering tools. In my “30 Days of GTAC” project, I’ll review the topics presented on GTAC. My goal is having a better and deeper understanding in modern testing technologies, methodologies, strategies, and practices.</p>

<p>Get it started! Day#1 topic is:</p>

<p><strong>The Uber Challenge of Cross-Application/Cross-Device Testing</strong></p>

<ul>
  <li>Presenter: Apple Chow (Uber), Bian Jiang (Uber)</li>
  <li><a href="https://www.youtube.com/watch?v=p6gsssppeT0&amp;list=PLSIUOFhnxEiCWGsN9t5A-XOhRbmz54IS1&amp;index=3">Video</a></li>
  <li><a href="https://docs.google.com/presentation/d/1vYXhkvgLKun72Ix91LQDDWZQdcY5VOBqKVvI1Y6riYo/pub">Slides</a></li>
</ul>

<p><strong>My takeaways</strong></p>

<ul>
  <li>The challenge: End-to-end tests require cross application communication (between rider app and driver app)</li>
  <li>Uber’s solution: Octopus
    <ul>
      <li>Octopus coordinates communication across different apps running on different devices</li>
      <li>This solution can be adopted for any tests that require coordination/communication across different apps or devices</li>
    </ul>
  </li>
  <li>What makes testing Uber’s mobile apps significantly different from testing Google Maps?</li>
  <li>Why (built) Octopus? Unified (iOS and Android). Extensible (Integrate with different UI testing frameworks). Parallelized. Signaling (enabling cross-app and cross-device testing).</li>
  <li>What does Octopus do? Prepare test targets. Run tests (handles signaling). Create test results reports. Pull test artifacts. Perform clean ups. All from simple command line.</li>
  <li>Signaling between driver test and rider test: Conducted with Test Host to improve the consistency. API readSignal (blocking), writeSignal (nonblocking). Test hosts and test targets are connected via USB (reliable).</li>
  <li>Apple Chow wrote about Octopus on <a href="http://eng.uber.com/rescued-by-octopus/">Uber Engineering</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20160920/python-dunder-methods.html">Dunder Methods in Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-20T21:28:51-07:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:28 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>In Python, we sometimes see method names with <code>__</code> around, such as the <code>__init__</code> method that every Class has. These methods are “dunder” methods (“dunder” stands for “double under” or “double underscore”). Dunder methods in Python are used for operator overloading and customizing behavior of other functions.</p>

<p>Sometimes dunder methods are also called “magic methods” because they are usually called by Python under the hood. But they are not really magical, you can define dunder methods to customize the behavior of your own classes.</p>

<h1 id="examples-of-dunder-methods">Examples of Dunder Methods</h1>

<p>In the following example, we can see three dunder methods:</p>

<ul>
  <li><code>__init__</code> method: is called to initialize the class</li>
  <li><code>__str__</code> method: is called when converting the object to a human-readable string</li>
  <li><code>__repr__</code> method: is called when converting the object to a developer-readable string</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class=""><span class="line">class Flower:
</span><span class="line">    def __init__(self, color='red'):
</span><span class="line">	    self.color = color
</span><span class="line">
</span><span class="line">	def __str__(self):
</span><span class="line">		return "Flower in color {color}".format(color=self.color)
</span><span class="line">
</span><span class="line">	def __repr__(self):
</span><span class="line">	return "Flower(color={})".format(self.color)</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In Python, many dunder methods are implemented and used for operations such as arithmetic operators, comparison operators, truthiness, etc. The following are a few examples:</p>

<p><strong>Arithmetic Operators</strong></p>

<ul>
  <li><code>+</code> : <code>__add__</code></li>
  <li><code>-</code> : <code>__sub__</code></li>
  <li><code>*</code> : <code>__mul__</code></li>
  <li><code>/</code> : <code>__div__</code></li>
</ul>

<p><strong>Comparison Operators</strong></p>

<ul>
  <li><code>x &lt; y</code> : <code>x.__lt__(y)</code></li>
  <li><code>x &lt;= y</code> : <code>x.__le__(y)</code></li>
  <li><code>x &gt; y</code> : <code>x.__gt__(y)</code></li>
  <li><code>x &gt;= y</code> : <code>x.__ge__(y)</code></li>
  <li><code>x == y</code> : <code>x.__eq__(y)</code></li>
  <li><code>x != y</code> : <code>x.__ge__(y)</code></li>
</ul>

<p>If you know about Bash shell, you may notice the name of these dunder methods are very similar to the operators in Bash.</p>

<p><strong>Truthiness</strong></p>

<ul>
  <li><code>bool(x)</code> : <code>x.__bool__()</code></li>
</ul>

<h1 id="use-dunder-methods-to-customize-class-behaviors">Use Dunder Methods to Customize Class Behaviors</h1>

<p>Dunder methods provide a way for our class to customize operators and other built-in Python behavior for our objects. In the following two examples, I’ll use dunder methods to overload arithmetic operators, and implement a dictionary that can be used with both attribute and item syntax.</p>

<h2 id="example-1-overload-arithmetic-operators">Example 1: Overload Arithmetic Operators</h2>

<p>Make an <code>is_callable</code> function to check if an object type is callable.</p>

<p>Example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&gt;&gt;&gt; is_callable(sorted)
</span><span class="line">True
</span><span class="line">&gt;&gt;&gt; is_callable(str)
</span><span class="line">True
</span><span class="line">&gt;&gt;&gt; is_callable(4)
</span><span class="line">False</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Source Code:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class=""><span class="line">def is_callable(obj):
</span><span class="line">
</span><span class="line">try:
</span><span class="line">	obj.__call__
</span><span class="line">	# hasattr(str, '__call__')
</span><span class="line">	# getattr(str, '__call__')
</span><span class="line">except AttributeError:
</span><span class="line">	return False
</span><span class="line">else:
</span><span class="line">	return True</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="example-2-class-easydict">Example 2: Class EasyDict</h2>

<p>Make an <code>EasyDict</code> class that can be used with both attribute and item syntax.</p>

<p>Example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&gt;&gt;&gt; a = EasyDict()
</span><span class="line">&gt;&gt;&gt; a['shoe'] = "blue"
</span><span class="line">&gt;&gt;&gt; a.shoe
</span><span class="line">"blue"
</span><span class="line">&gt;&gt;&gt; a['shoe']
</span><span class="line">"blue"
</span><span class="line">&gt;&gt;&gt; a.car = "green"
</span><span class="line">&gt;&gt;&gt; a['car']
</span><span class="line">"green"</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Source Code:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class=""><span class="line">class EasyDict:
</span><span class="line">	def __init__(self):
</span><span class="line">    	pass
</span><span class="line">
</span><span class="line">   		def __getitem__(self, item):
</span><span class="line">    	return self.__dict__[item]
</span><span class="line">
</span><span class="line">	def __setitem__(self, key, value):
</span><span class="line">    	self.__dict__[key] = value
</span></code></pre></td></tr></table></div></figure></notextile></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20160815/case-study-check-on-a-commit-according-to-the-included-files.html">Case Study: Check on a Commit According to Its Included Files</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-08-15T19:43:21-07:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>7:43 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="problem-description">Problem Description</h1>

<p>Suppose one task in your Continuous Integration (CI) pipeline is triggered on every commit to the project repository. Some the files in the repository require passing the check of the CI task, while some other files do not require passing the check. What should the CI task do to decide if it is needed to perform the needed checking on the commit?</p>

<h1 id="design-the-ci-task">Design the CI task</h1>

<p>The CI task need have the ability to analyze the files included in the commit, and decide whether the commit requires passing a check, or not. We need tell the CI task which files require passing a check through configurations.</p>

<h2 id="configuration">Configuration</h2>

<p>There are multiple ways to design the configurations, such as:</p>

<ol>
  <li>
    <p>Only list the files or paths requiring the check</p>
  </li>
  <li>
    <p>Only list the files or paths do not require the check</p>
  </li>
  <li>
    <p>List the files or paths requiring the check, and also list the subset files or paths that do not require the check</p>
  </li>
</ol>

<p>The 3rd way probably is the optimal one because it provides the flexibility for you to put a large scope path as the files need check, and then exclude a subset from the large scope path. For example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line">check: my_project/dev/
</span><span class="line">
</span><span class="line">skip: my_project/dev/test/
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>To apply the 3rd method, the configuration of the CI task will include two types: inclusion, and exclusion.</p>

<h2 id="analyze-files-in-the-commit">Analyze files in the commit</h2>

<p>The needed analysis process of the CI task is:</p>

<ul>
  <li>
    <p>If none of the files in the commit matches the inclusion in configuration, skip the check</p>
  </li>
  <li>
    <p>If all the files in the commit matching the inclusion in configuration also matching the exclusion in configuration, skip the check</p>
  </li>
  <li>
    <p>In other cases, the check for this commit is needed</p>
  </li>
</ul>

<p>The complexity of the given process is <em>O(n<sup>2</sup>)</em>.</p>

<p>A mistake that could happen in the analysis process is when you analyze the exclusion cases, you should do the analysis only on the files that match inclusion configuration, which is a subset of files in the commit.</p>

<h1 id="example-with-the-python">Example with the Python</h1>

<p>Here is the code written in Python for demonstrating the case discussed above.</p>

<ul>
  <li>
    <p><code>commit_files</code>: a list containing all the files in the commit</p>
  </li>
  <li>
    <p><code>config</code>: a dictionary containing inclusion and exclusion configurations</p>
  </li>
  <li>
    <p><code>config['include']</code>: a list containing all the files or paths need check</p>
  </li>
  <li>
    <p><code>config['exclude']</code>: a list containing the files or paths do not need check</p>
  </li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line">def analyze_commit_files(commit_files, config):
</span><span class="line">
</span><span class="line">    need_check = False    
</span><span class="line">
</span><span class="line">    
</span><span class="line">
</span><span class="line">    # commit need_check is False if:    
</span><span class="line">
</span><span class="line">    # - No files in this commit    
</span><span class="line">
</span><span class="line">    # - Config does not have any 'include' defined    
</span><span class="line">
</span><span class="line">    if commit_files is None or len(commit_files) == 0:
</span><span class="line">
</span><span class="line">        return need_check
</span><span class="line">
</span><span class="line">    if not 'include' in config or config['include'] is None or len(config['include']) == 0:
</span><span class="line">
</span><span class="line">        return need_check
</span><span class="line">
</span><span class="line">    # commit need_check is False if:    
</span><span class="line">
</span><span class="line">    # - All file in the commit matches the configured inclusion, OR    
</span><span class="line">
</span><span class="line">    # - All files in the commit that matches the inclusion, also match the configured exclusion    
</span><span class="line">
</span><span class="line">    # First check inclusion    
</span><span class="line">
</span><span class="line">    files_need_check = list()
</span><span class="line">
</span><span class="line">    for cf in commit_files:
</span><span class="line">
</span><span class="line">        for check_file in config['include']:            
</span><span class="line">
</span><span class="line">            if re.search(check_file, cf):                            
</span><span class="line">
</span><span class="line">                files_need_check.append(cf)
</span><span class="line">
</span><span class="line">    
</span><span class="line">
</span><span class="line">    if len(files_need_check) &gt; 0:
</span><span class="line">
</span><span class="line">        # Check skip_path
</span><span class="line">
</span><span class="line">        if not 'exclude' in config or config['exclude'] is None or len(config['exclude']) == 0:
</span><span class="line">
</span><span class="line">            need_check = True
</span><span class="line">
</span><span class="line">         else:
</span><span class="line">
</span><span class="line">             for cf in files_need_check:
</span><span class="line">
</span><span class="line">                 for skip_file in config['exclude']:                         
</span><span class="line">
</span><span class="line">                    if not re.search(skip_file, cf):                       
</span><span class="line">
</span><span class="line">                        need_check = True
</span><span class="line">
</span><span class="line">                        break
</span><span class="line">
</span><span class="line">    return need_check
</span></code></pre></td></tr></table></div></figure></notextile></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20160807/python-unittest-handle-command-line-arguments.html">Python Unittest: Handle the Command Line Arguments</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-08-07T11:57:32-07:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>11:57 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>In the previous post about <a href="http://euccas.github.io/blog/20160711/start-unit-testing-in-python.html">Python Unittest</a>, I wrote about the basic steps needed for setting up unit testing for your Python program with the <code>unittest</code> module. In this post, I’ll discuss about handling the command line parameters that your program need while you’re using Python <code>unittest</code>.</p>

<p>Unit testing is meant for testing basic functionality of the application. The target of <a href="https://en.wikipedia.org/wiki/Unit_testing">Unit testing</a> is expected to be each function of your program. When your program has command line arguments, ideally the unit tests should not accept arguments from the command line because unit tests are supposed to be very specific and not testing on the <a href="https://en.wikipedia.org/wiki/Integration_testing">Integration level</a> (i.e. across multiple functions in your program).</p>

<p>So the way I use to handle the command line arguments can be summarized as:</p>

<ul>
  <li>Refactor your program to have the arguments parsing as a function</li>
  <li>Refactor your program to handle the arguments parsing differently when doing unit testing</li>
  <li>In the unit tests, set the arguments and pass them directly to the functions under test</li>
</ul>

<p>The following is a demo Python project I built to demonstrate handling command line arguments when using <code>unittest</code>.</p>

<h2 id="myapppy">myapp.py</h2>

<pre><code>#!/usr/bin/env python

import sys, os.path, re
import argparse

class myApp():

    EXIT_PASS, EXIT_FAIL = 0, 1

    def __init__(self, mode = 'normal', test_param = None):
        # Validate and process argument options
        self.parse_args(mode, test_param)
        # Initialize database connection
        self.app_name = self.get_app_name(self.name)

    def parse_args(self, mode, test_param):
        if mode == 'unittest':
            if test_param is None:
                print("Missing test param")
                self.app_exit('fail')

            self.name = test_param['app_name']
            self.verbose = test_param['verbose']
        else:
            parser = argparse.ArgumentParser(description='myApp: A demo project')
            parser.add_argument('-n', '--name', help='Name of myApp', required=True)
            parser.add_argument('--verbose', action='store_true', help='Verbose mode with more information printed')

            args = parser.parse_args()

            self.name = args.name
            self.verbose = args.verbose

    def app_exit(self, status):
        if status.lower() == 'pass':
            print("** App Exit Status: PASS \n")
            exit(self.EXIT_PASS)
        elif status.lower() == 'skip':
            print("** App Exit Status: SKIP \n")
            exit(self.EXIT_PASS)
        else:
            print("** App Exit Status: FAIL \n")
            exit(self.EXIT_FAIL)

    def get_app_name(self):
        app_name = self.name

        return app_name

if __name__ == '__main__':
    app = myApp()
</code></pre>

<h2 id="testmyapppy">test_myapp.py</h2>

<pre><code>#!/usr/bin/env python

import sys, os.path, re
import argparse
import unittest

bin_path = os.path.dirname(os.path.realpath(__file__))
lib_path = os.path.abspath(bin_path)
sys.path.insert(0, lib_path)

import myApp

class myAppTestCase(unittest.TestCase):

    def setUp(self):
        mode = 'unittest'
        test_param = {
            'name': 'Test App',
            'verbose': True
        }
        self.app = myapp.myApp(mode, test_param)

    def test_app_name(self):
        self.assertEqual(self.app.get_app_name, 'Test App', 'Wrong App Name')

    def tearDown(self):
        print('Bye Test')

if __name__ == '__main__':
    unittest.main()
</code></pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20160711/start-unit-testing-in-python.html">Start Unit Testing in Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-11T22:58:39-07:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:58 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>When is the best time to start unit testing in your Python project? My answer is before you writing the first line of code of this project. Unit testing is the fundamental of Test-driven development, which specifically improves the quality and design of your project.</p>

<p>In this post, I’m writing about how could you do unit testing in Python with the <code>unittest</code> module.</p>

<p>Python 2 (starting on version 2.1) and Python 3 now both have <code>unittest</code> in the standard library. The <code>unittest</code> module provides the unit testing framework, and it’s based on <code>JUnit</code>, which is a unit testing framework for Java.</p>

<h1 id="what-unittest-can-do">What unittest can do</h1>

<p>A few main features that <code>unittest</code> can do are:</p>

<ul>
  <li>Automatically run the tests (by <code>test runner</code>)</li>
  <li>Create test cases (by <code>test case</code>)</li>
  <li>Sharing of setup and shutdown code for tests (by <code>test fixture</code>)</li>
  <li>Aggrate tests into collections (by <code>test suite</code>)</li>
  <li>Independence of the tests from the reporting framework</li>
</ul>

<h1 id="how-does-unittest-work">How does unittest work</h1>

<p>Suppose I’m working on a project called <code>demo</code>, and it has a file structure as:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">demo
</span><span class="line">-- dev
</span><span class="line">   -- __init__.py
</span><span class="line">   -- demoDev.py</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Note the <code>___init___.py</code> file can be empty. The purpose of having this file is for other files outside this directory can easily import the module <code>demoDev.py</code>.</p>

<p>To create unit tests for this project, I’ll need continue the following steps.</p>

<h2 id="create-the-test-file">1. Create the test file</h2>

<p>There is no particular required folder structure that you need to keep your test files. The way I usually do is separating the tests from the project source files. So, I create a <code>test</code> folder in the same level as <code>dev</code>. All my tests will be put into this folder. Now the project’s structure looks like:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class=""><span class="line">demo
</span><span class="line">-- dev
</span><span class="line">   -- __init__.py
</span><span class="line">   -- demoDev.py
</span><span class="line">-- test
</span><span class="line">   -- test_demoDev.py</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="use-unittest-module-in-your-project">2. Use unittest module in your project</h2>

<p>The test file need import the <code>unittest</code> module.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line"># This is test/test_demoDev.py
</span><span class="line">
</span><span class="line">import unittest</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="include-your-project-modules-in-the-test">3. Include your project modules in the test</h2>

<p>Surely you’ll need include the source files of the modules that you want to test in your test file. If your tests are in the same folder of your module sources, you can simply use <code>import SomeModule</code> to pull the modules in. When your tests stay out of the module sources, you’ll need do a little configurations in your test file.</p>

<p>I found the way to import your own modules to your tests can be different depending your development environment. For example, if you run your Python projects within some IDE, like <strong>PyCharm</strong> from JetBrains. The following way always work:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line"># This is test/test_demoDev.py
</span><span class="line">
</span><span class="line">from dev import demoDev
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>However if you run through command line <code>python test/test_demoDev.py</code>, you might see errors complaining no module called <code>dev</code> and thus the import fails.</p>

<p>What you can do to resolve this problem, is adding the path of your Python modules to the <code>sys.path</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line"># This is test/test_demoDev.py
</span><span class="line">
</span><span class="line">import sys, os.path
</span><span class="line">
</span><span class="line">bin_path = os.path.dirname(os.path.realpath(__file__))
</span><span class="line">lib_path = os.path.abspath(os.path.join(bin_path, '..', 'dev'))
</span><span class="line">sys.path.insert(0, lib_path)
</span><span class="line"># or sys.path.append(lib_path)
</span><span class="line">
</span><span class="line">import demoDev
</span><span class="line">
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="create-a-test-case">4. Create a test case</h2>

<p>A test case can be created with unittest <em>TestCase</em> class. The <code>setUp()</code> and <code>tearDown()</code> methods can be overridden to provide initialization and cleanup for the fixture. Each instance of the TestCase will only be used to run a single test method. Multiple test methods share the same text fixture, but the test fixture are created for each test method when they are executed.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line"># This is test/test_demoDev.py
</span><span class="line">
</span><span class="line">import sys
</span><span class="line">import unittest
</span><span class="line">
</span><span class="line">bin_path = os.path.dirname(os.path.realpath(__file__))
</span><span class="line">lib_path = os.path.abspath(os.path.join(bin_path, '..', 'dev'))
</span><span class="line">sys.path.insert(0, lib_path)
</span><span class="line">
</span><span class="line">from dev import demoDev
</span><span class="line">
</span><span class="line">class demoDevTestCase(unittest.TestCase):
</span><span class="line">
</span><span class="line">    def setUp(self):
</span><span class="line">        self.checker = eABTCheckerDev.eABTChecker()
</span><span class="line">
</span><span class="line">    def test_checker_app(self):
</span><span class="line">        self.assertEqual(self.demo.app, 'Demo App', 'Wrong app')
</span><span class="line">
</span><span class="line">    def tearDown(self):
</span><span class="line">        print('Bye Test')
</span><span class="line">
</span><span class="line">if __name__ == '__main__':
</span><span class="line">    unittest.main()
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The <code>TestCase</code> class provides several assert methods to check for and report failures, such as <code>assertEqual</code>, <code>assertNotEqual</code>, <code>assertTrue</code>. <a href="https://docs.python.org/3.4/library/unittest.html#assert-methods">Here is the complete assert list that Python 3 provides.</a></p>

<h2 id="create-more-tests-and-a-test-suites">5. Create more tests and a test suites</h2>

<p><code>TestSuite</code> class represents an aggregation of individual test cases and test suites. The <code>addTest</code> and <code>addTests</code> methods are available to add tests to your TestSuite instances.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line"># This is test_demoDev.py
</span><span class="line">
</span><span class="line">def suite():
</span><span class="line">    suite = unittest.TestSuite();
</span><span class="line">    suite.addTest(demoDevTestCase('test_checker_app'))
</span><span class="line">    suite.addTest(demoDevTestCase('test_check_env'))
</span><span class="line">    
</span><span class="line">    return suite
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="run-your-unit-tests">6. Run your unit tests!</h1>

<p>The easiest way to run your unit tests is executing the <code>unittest.main()</code> method in the test file.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line"># This is test_demoDev.py
</span><span class="line">
</span><span class="line">if __name__ == '__main__':
</span><span class="line">    unittest.main()
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Then by running command <code>python test_demoDev.py</code>, the tests defined in <code>test_demoDev.py</code> will start running.</p>

<p>Unit tests can run from command line, because <code>unittest</code> module can be used from the command line to run tests from modules, classes or individual test methods.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line">python -m unittest test_demoDev.test_checker_app
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>You’ll see the testing result like:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line">----------------------------------------------------------------------
</span><span class="line">Ran 1 test in 0.000s
</span><span class="line">
</span><span class="line">OK
</span><span class="line">Bye Test
</span><span class="line">
</span><span class="line">Process finished with exit code 0
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Behind the tests running, there is the <code>run</code> method provided by <code>TestCase</code> and <code>TestCaseSuite</code> classes. This <code>run</code> method implements the function of running the test, collecting the result into the <code>TestResult</code> object passed as result.</p>

<p>Here you go! Enjoy unit testing in Python!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20160614/rake-automake-your-tasks-in-ruby.html">Rake: Automake Your Tasks in Ruby</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-14T17:59:06-07:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>5:59 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Rake is the build language for Ruby programs, originally developed by <a href="http://onestepback.org/">Jim Weirich</a>. It’s a standard library in Ruby 2.1. You can define tasks with Rake: named code blocks that carry out specific actions, such as running unit tests, deploy your code to github, etc. In this post, I’ll write about the basics of Rake and how to use it to automate the tasks of your Ruby projects.</p>

<h1 id="rakefile">Rakefile</h1>

<p>In order to use Rake to define tasks, first you need a Rakefile. A Rakefile is a Ruby source file that has access to some special methods: <strong>task</strong>, <strong>file</strong>, <strong>directory</strong>, and a few others. A task defined in the Rakefile can be run by the command-line <code>rake</code> program, or be called as a dependency by other tasks. The name of Rakefile can be <code>Rakefile</code> or <code>rakefile</code>.</p>

<h1 id="write-descriptions-for-rake-tasks">Write Descriptions for Rake Tasks</h1>

<p>Writing a description to the defined tasks in Rakefile help you get more details about the task and know better what it does.</p>

<p>Example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">desc 'Upload documentation to server'
</span><span class="line">task 'upload-docs' =&gt; ['rdoc'] do
</span><span class="line">    sh "scp -r #{html_dir}/* " + "#{user}:#{server_path}"
</span><span class="line">end
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="namespaces">Namespaces</h1>

<p>Using namespaces is a good way to group similar tasks in Rakefile. You’ll need specify the namespace when calling a task inside it. One example as you can see from Rails is this command</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">rake db:migrate</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In this command, the <strong><em>db</em></strong> is the namespace, and the <strong><em>migrate</em></strong> is the task inside the namespace.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class=""><span class="line">namespace :cleanup do
</span><span class="line">    desc 'Clean up database'
</span><span class="line">    task  :dbs =&gt; :environment do
</span><span class="line">        Db.cleanup
</span><span class="line">    end
</span><span class="line">
</span><span class="line">    desc 'Clean up logs'
</span><span class="line">    task :logs =&gt; :environment do
</span><span class="line">        Log.cleanup
</span><span class="line">    end
</span><span class="line">
</span><span class="line">    task :all =&gt; [:dbs, :logs]
</span><span class="line">end
</span><span class="line">
</span><span class="line">desc 'Cleanup everything'
</span><span class="line">task :cleanup =&gt; "cleanup:all"
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="default-task">Default Task</h1>

<p>The default task is the one gets executed when you run rake without any arguments. You can set the default task in Rakefile by using the <code>:default</code> keyword.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">task :default =&gt; 'cleanup'</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">task :default =&gt; 'logs: cleanup'</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="multiple-tasks-running-in-parallel">Multiple Tasks Running in Parallel</h1>
<p>Rake’s <code>multitask</code> function supports running multiple tasks in parallel. The method is defining a task using the <code>multitask</code> function, and each of this task’s prerequisites will be run in a separate thread.</p>

<p>An example of multiple parallel tasks:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class=""><span class="line">task 'copy_docs' do
</span><span class="line">    # Simulate a large disk copy
</span><span class="line">    sleep 5
</span><span class="line">end
</span><span class="line">
</span><span class="line">task 'compile_extensions' do
</span><span class="line">    # Simulate a C compiler compiling a bunch of files
</span><span class="line">    sleep 10
</span><span class="line">end
</span><span class="line">
</span><span class="line">task 'build_serial' =&gt; ['copy_docs', 'compile_extensions]
</span><span class="line">multitask 'build_parallel' =&gt; ['copy_docs', 'compile_extensions']
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In this example, the <code>build_serial</code> task runs in about 15 seconds, but the <code>build_parallel</code> task runs in about 10 seconds.</p>

<h1 id="invoke-tasks">Invoke tasks</h1>

<p>Rake tasks can be invoked from other tasks using the <code>Rake::Task['&lt;your take&gt;'].invoke</code> method.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line">task :cleanup do
</span><span class="line">    Rake::Task['logs: cleanup'].invoke
</span><span class="line">    puts "logs are cleaned!"
</span><span class="line">    Rake::Task['dbs: cleanup'].invoke
</span><span class="line">    puts "dbs are cleaned!"
</span><span class="line">end
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="view-all-the-rake-tasks">View all the Rake tasks</h1>

<p>To get an overview of all the defined Rake tasks, use <code>rake -T</code></p>

<h1 id="include-external-rakefiles">Include external rakefiles</h1>

<p>When your project need include the Rake tasks defined in external directories, you’ll need include the external rakefiles into your project. The way to do it is using the <code>import</code>. Note the <code>require</code> won’t work here, as it looks for the <code>.rb</code> files instead of the <code>.rake</code> files.</p>

<p>Include one rakefile:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">import File.dirname(__FILE__)+"/../../task/common/rakefile"</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Include multiple rakefiles in nested directories:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line">Dir.glob("#{File.dirname(__FILE__)}/*").each do |d|
</span><span class="line">  next if !File.directory? d
</span><span class="line">  import d + "/rakefile" if File.file?(d + "/rakefile")
</span><span class="line">end
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="exit-from-rake-tasks">Exit from Rake tasks</h1>

<p>In a Ruby function, you can use <code>return</code> in the function when you want to exit (early). But in Rake tasks, the <code>return</code> is an invalid method to use, because each Rake task is actually a <code>Proc</code>. To exit early from a Rake task, you can use one of the following methods:</p>

<ul>
  <li>next</li>
</ul>

<p><strong><em>next</em></strong> will discard the following codes in the current rake task, and process the following part of the other tasks if there are any.</p>

<ul>
  <li>fail/raise</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line">task :something do
</span><span class="line">  [1,2,3].each do |i|
</span><span class="line">    ...
</span><span class="line">    fail "some error" if ...
</span><span class="line">  end
</span><span class="line">end
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>
    <p>exit</p>
  </li>
  <li>
    <p>abort</p>
  </li>
</ul>

<p>When <strong><em>abort</em></strong> is used in a rescue block, it terminates the task as well as prints the whole error (even without using –trace).</p>

<h1 id="reference">Reference</h1>

<ul>
  <li><a href="https://www.amazon.com/Ruby-Cookbook-Lucas-Carlson/dp/1449373712">Ruby Cookbook 2nd Edition (L. Carlson)</a></li>
  <li><a href="http://martinfowler.com/articles/rake.html">Using the Rake Build Language (Martin Fowler)</a></li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20160610/rails-get-data-without-model.html">Rails: Get Data From PostgreSQL Database Without the Model</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-10T18:32:01-07:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:32 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>In Ruby on Rails, Active Record is the M in MVC - the model. Model is the layer of the system which represents business data and logic. Active Record facilitates the creation and the use of business objects whose data requires persistent storage to a database. In some cases, however, you may want to use databases in Rails applications without the Model. What you can do is using the <code>pg</code> gem to directly manipulate the data you need.</p>

<h1 id="create-a-database-connection">Create a database connection</h1>

<p>If the database is not declared in Rails app’s <code>config/database.yml</code> file, you won’t be able to use the <code>establish_connection</code> method in ActiveRecord. But you can still use the <code>pg</code> gem to directly connect to the database.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line"># page_controller.rb
</span><span class="line">
</span><span class="line">conn = PGconn.connect('&lt;server&gt;', &lt;port&gt;, "", "", '&lt;database&gt;', "&lt;user&gt;", "&lt;password&gt;")
</span><span class="line">render :plain =&gt; "Oops, database currently not accessible" unless conn
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="query-data-with-raw-sql">Query data with RAW SQL</h1>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class=""><span class="line"># page_controller.rb
</span><span class="line">
</span><span class="line">@page_records = []
</span><span class="line">result = conn.exec('SELECT * FROM &lt;table&gt; ORDER BY id DESC')
</span><span class="line">
</span><span class="line">@page_records = result
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The result is an array of Hash. For example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">[
</span><span class="line">  { "title" =&gt; "my page 1", "author" =&gt; "Tom", "created_at" =&gt; "2016-06-08" }
</span><span class="line">  { "title" =&gt; "my page 2", "author" =&gt; "Nancy", "created_at" =&gt; "2016-06-09" }
</span><span class="line">]</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="use-the-data-in-view">Use the data in View</h1>

<p>When using the queried data in Rails View, need to note you need use <code>record['title']</code> instead of <code>record.title</code>, which is different from using the data generated from a Rails Model.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class=""><span class="line"># page.erb
</span><span class="line">
</span><span class="line">&lt;div&gt;
</span><span class="line">    &lt;% @page_records.each do |record| %&gt;
</span><span class="line">        &lt;p&gt; &lt;%= record['title'] %&gt; &lt;/p&gt;
</span><span class="line">        &lt;p&gt; &lt;%= record['author'] %&gt; &lt;/p&gt;
</span><span class="line">    &lt;% end %&gt;
</span><span class="line">&lt;/div&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="as-a-note-in-the-end">As a note in the end</h1>

<p>Although the above approach works in Rails, I’d say a more decent way to handle the need of getting data from multiple databases, is creating a crafted Model. The process will need:</p>

<ul>
  <li>Add the configurations of all your external databases in Rails app</li>
  <li>Create a Model file</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">class Pages &lt; ActiveRecord::Base
</span><span class="line">
</span><span class="line">end</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li>Use <code>establish_connection</code> in the Model</li>
  <li>When your table name doesn’t match Rails convention, set the table name with <code>self.table_name = '&lt;your table name&gt;'</code></li>
  <li>Create methods in the Model to fetch the data you need</li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - euccas -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  










  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
