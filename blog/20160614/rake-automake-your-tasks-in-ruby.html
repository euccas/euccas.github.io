
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Rake: Automake Your Tasks in Ruby - euccas.github.io</title>
  <meta name="author" content="euccas">

  
  <meta name="description" content="Rake is the build language for Ruby programs, originally developed by Jim Weirich. It’s a standard library in Ruby 2.1. You can define tasks with &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://euccas.github.io/blog/20160614/rake-automake-your-tasks-in-ruby.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="euccas.github.io" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">euccas.github.io</a></h1>
  
    <h2>why a developer writes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="euccas.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Rake: Automake Your Tasks in Ruby</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-14T17:59:06-07:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>5:59 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Rake is the build language for Ruby programs, originally developed by <a href="http://onestepback.org/">Jim Weirich</a>. It’s a standard library in Ruby 2.1. You can define tasks with Rake: named code blocks that carry out specific actions, such as running unit tests, deploy your code to github, etc. In this post, I’ll write about the basics of Rake and how to use it to automate the tasks of your Ruby projects.</p>

<h1 id="rakefile">Rakefile</h1>

<p>In order to use Rake to define tasks, first you need a Rakefile. A Rakefile is a Ruby source file that has access to some special methods: <strong>task</strong>, <strong>file</strong>, <strong>directory</strong>, and a few others. A task defined in the Rakefile can be run by the command-line <code>rake</code> program, or be called as a dependency by other tasks. The name of Rakefile can be <code>Rakefile</code> or <code>rakefile</code>.</p>

<h1 id="write-descriptions-for-rake-tasks">Write Descriptions for Rake Tasks</h1>

<p>Writing a description to the defined tasks in Rakefile help you get more details about the task and know better what it does.</p>

<p>Example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">desc 'Upload documentation to server'
</span><span class="line">task 'upload-docs' =&gt; ['rdoc'] do
</span><span class="line">    sh "scp -r #{html_dir}/* " + "#{user}:#{server_path}"
</span><span class="line">end
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="namespaces">Namespaces</h1>

<p>Using namespaces is a good way to group similar tasks in Rakefile. You’ll need specify the namespace when calling a task inside it. One example as you can see from Rails is this command</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">rake db:migrate</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In this command, the <strong><em>db</em></strong> is the namespace, and the <strong><em>migrate</em></strong> is the task inside the namespace.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class=""><span class="line">namespace :cleanup do
</span><span class="line">    desc 'Clean up database'
</span><span class="line">    task  :dbs =&gt; :environment do
</span><span class="line">        Db.cleanup
</span><span class="line">    end
</span><span class="line">
</span><span class="line">    desc 'Clean up logs'
</span><span class="line">    task :logs =&gt; :environment do
</span><span class="line">        Log.cleanup
</span><span class="line">    end
</span><span class="line">
</span><span class="line">    task :all =&gt; [:dbs, :logs]
</span><span class="line">end
</span><span class="line">
</span><span class="line">desc 'Cleanup everything'
</span><span class="line">task :cleanup =&gt; "cleanup:all"
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="default-task">Default Task</h1>

<p>The default task is the one gets executed when you run rake without any arguments. You can set the default task in Rakefile by using the <code>:default</code> keyword.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">task :default =&gt; 'cleanup'</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">task :default =&gt; 'logs: cleanup'</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="multiple-tasks-running-in-parallel">Multiple Tasks Running in Parallel</h1>
<p>Rake’s <code>multitask</code> function supports running multiple tasks in parallel. The method is defining a task using the <code>multitask</code> function, and each of this task’s prerequisites will be run in a separate thread.</p>

<p>An example of multiple parallel tasks:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class=""><span class="line">task 'copy_docs' do
</span><span class="line">    # Simulate a large disk copy
</span><span class="line">    sleep 5
</span><span class="line">end
</span><span class="line">
</span><span class="line">task 'compile_extensions' do
</span><span class="line">    # Simulate a C compiler compiling a bunch of files
</span><span class="line">    sleep 10
</span><span class="line">end
</span><span class="line">
</span><span class="line">task 'build_serial' =&gt; ['copy_docs', 'compile_extensions]
</span><span class="line">multitask 'build_parallel' =&gt; ['copy_docs', 'compile_extensions']
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In this example, the <code>build_serial</code> task runs in about 15 seconds, but the <code>build_parallel</code> task runs in about 10 seconds.</p>

<h1 id="invoke-tasks">Invoke tasks</h1>

<p>Rake tasks can be invoked from other tasks using the <code>Rake::Task['&lt;your take&gt;'].invoke</code> method.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line">task :cleanup do
</span><span class="line">    Rake::Task['logs: cleanup'].invoke
</span><span class="line">    puts "logs are cleaned!"
</span><span class="line">    Rake::Task['dbs: cleanup'].invoke
</span><span class="line">    puts "dbs are cleaned!"
</span><span class="line">end
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="view-all-the-rake-tasks">View all the Rake tasks</h1>

<p>To get an overview of all the defined Rake tasks, use <code>rake -T</code></p>

<h1 id="include-external-rakefiles">Include external rakefiles</h1>

<p>When your project need include the Rake tasks defined in external directories, you’ll need include the external rakefiles into your project. The way to do it is using the <code>import</code>. Note the <code>require</code> won’t work here, as it looks for the <code>.rb</code> files instead of the <code>.rake</code> files.</p>

<p>Include one rakefile:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">import File.dirname(__FILE__)+"/../../task/common/rakefile"</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Include multiple rakefiles in nested directories:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line">Dir.glob("#{File.dirname(__FILE__)}/*").each do |d|
</span><span class="line">  next if !File.directory? d
</span><span class="line">  import d + "/rakefile" if File.file?(d + "/rakefile")
</span><span class="line">end
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="exit-from-rake-tasks">Exit from Rake tasks</h1>

<p>In a Ruby function, you can use <code>return</code> in the function when you want to exit (early). But in Rake tasks, the <code>return</code> is an invalid method to use, because each Rake task is actually a <code>Proc</code>. To exit early from a Rake task, you can use one of the following methods:</p>

<ul>
  <li>next</li>
</ul>

<p><strong><em>next</em></strong> will discard the following codes in the current rake task, and process the following part of the other tasks if there are any.</p>

<ul>
  <li>fail/raise</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class=""><span class="line">
</span><span class="line">task :something do
</span><span class="line">  [1,2,3].each do |i|
</span><span class="line">    ...
</span><span class="line">    fail "some error" if ...
</span><span class="line">  end
</span><span class="line">end
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>
    <p>exit</p>
  </li>
  <li>
    <p>abort</p>
  </li>
</ul>

<p>When <strong><em>abort</em></strong> is used in a rescue block, it terminates the task as well as prints the whole error (even without using –trace).</p>

<h1 id="reference">Reference</h1>

<ul>
  <li><a href="https://www.amazon.com/Ruby-Cookbook-Lucas-Carlson/dp/1449373712">Ruby Cookbook 2nd Edition (L. Carlson)</a></li>
  <li><a href="http://martinfowler.com/articles/rake.html">Using the Rake Build Language (Martin Fowler)</a></li>
</ul>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">euccas</span></span>

      




<time class='entry-date' datetime='2016-06-14T17:59:06-07:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>5:59 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ruby/'>ruby</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://euccas.github.io/blog/20160614/rake-automake-your-tasks-in-ruby.html" data-via="" data-counturl="http://euccas.github.io/blog/20160614/rake-automake-your-tasks-in-ruby.html" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/20160610/rails-get-data-without-model.html" title="Previous Post: Rails: Get data from PostgreSQL database without the Model">&laquo; Rails: Get data from PostgreSQL database without the Model</a>
      
      
        <a class="basic-alignment right" href="/blog/20160711/start-unit-testing-in-python.html" title="Next Post: Start Unit Testing in Python">Start Unit Testing in Python &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/20160807/python-unittest-handle-command-line-arguments.html">Python Unittest: Handle the Command Line Arguments</a>
      </li>
    
      <li class="post">
        <a href="/blog/20160711/start-unit-testing-in-python.html">Start Unit Testing in Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/20160614/rake-automake-your-tasks-in-ruby.html">Rake: Automake Your Tasks in Ruby</a>
      </li>
    
      <li class="post">
        <a href="/blog/20160610/rails-get-data-without-model.html">Rails: Get Data From PostgreSQL Database Without the Model</a>
      </li>
    
      <li class="post">
        <a href="/blog/20160607/ruby-class-and-instance-methods.html">Ruby Class and Instance Methods</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - euccas -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
